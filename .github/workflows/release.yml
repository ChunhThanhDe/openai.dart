name: Release Workflow.

on:
  push:
    branches: ["main"]
  pull_request:
    branches: ["main"]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Checking commit message

        run: |
          echo "This commit contains the word 'release'. Creating a release..."

      - name: Extracting Version Number Of The Current Release
        run: |
          VERSION=$(grep -oP "version:\s*\K.*" pubspec.yaml)
          echo "VERSION: V$VERSION detected"
          echo "VERSION=${VERSION}" >> $GITHUB_ENV

      - name: Check if release exists
        id: check_release
        uses: peter-evans/release-check@v1
        with:
          tag: ${{ env.VERSION }}
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Creating New Release
        if: steps.check_release.outputs.release_exists == 'false'
        uses: actions/create-release@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          tag_name: ${{ env.VERSION }}
          release_name: ${{ env.VERSION }}
          draft: false
          prerelease: false
